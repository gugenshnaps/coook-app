<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cafe TMA - –°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏</title>
    <link rel="stylesheet" href="cafe-tma.css">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc, onSnapshot, query, where, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCBv4tfDPHboApf6CXtUqLIReQA4KzjQJg",
            authDomain: "coook-app.firebaseapp.com",
            projectId: "coook-app",
            storageBucket: "coook-app.firebasestorage.app",
            messagingSenderId: "1027223490741",
            appId: "1:1027223490741:web:a56a826d5d16d517f2aefc",
            measurementId: "G-1XZV0W4QPR"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.firebase = { db, collection, getDocs, addDoc, updateDoc, deleteDoc, doc, onSnapshot, query, where, orderBy };
    </script>
</head>
<body>
    <div class="tma-container">
        <!-- Login Screen -->
        <div id="loginScreen" class="screen active">
            <div class="login-header">
                <h1>‚òï –°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏</h1>
                <p>–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–∏–º –∫–∞—Ñ–µ</p>
            </div>
            
            <div class="login-form">
                <div class="form-group">
                    <label for="cafeLogin">–õ–æ–≥–∏–Ω –∫–∞—Ñ–µ:</label>
                    <input type="text" id="cafeLogin" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: starbucks1, cafecentral2..." required autocomplete="off">
                </div>
                
                <div class="form-group">
                    <label for="cafePassword">–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="cafePassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                </div>
                
                <button onclick="loginCafe()" class="login-btn">–í–æ–π—Ç–∏</button>
            </div>
            
            <div class="login-help">
                <p>‚ùì –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å? –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É</p>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div id="dashboardScreen" class="screen">
            <div class="dashboard-header">
                <div class="cafe-info">
                    <h2 id="cafeName">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ñ–µ</h2>
                    <p id="cafeLocation">–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</p>
                </div>
                <button onclick="logout()" class="logout-btn">–í—ã–π—Ç–∏</button>
            </div>
            
            <div class="dashboard-stats">
                <div class="stat-card">
                    <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–Ω—è</h3>
                    <div class="stat-item">
                        <span>–ü–æ—Å–µ—Ç–∏—Ç–µ–ª–∏:</span>
                        <strong id="dailyVisitors">0</strong>
                    </div>
                    <div class="stat-item">
                        <span>–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:</span>
                        <strong id="dailyTransactions">0</strong>
                    </div>
                    <div class="stat-item">
                        <span>–ë–∞–ª–ª–æ–≤ –≤—ã–¥–∞–Ω–æ:</span>
                        <strong id="dailyPoints">0</strong>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-actions">
                <button onclick="showEarnPoints()" class="action-btn earn-btn">
                    üí∞ –ù–∞—á–∏—Å–ª–∏—Ç—å –±–∞–ª–ª—ã
                </button>
                <button onclick="showSpendPoints()" class="action-btn spend-btn">
                    üéØ –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å–∫–∏–¥–∫—É
                </button>
                <button onclick="showLoyaltySettings()" class="action-btn settings-btn">
                    ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                </button>
            </div>
        </div>

        <!-- Earn Points Modal -->
        <div id="earnPointsModal" class="modal">
            <div class="modal-content large-modal">
                <div class="modal-header">
                    <h3>üí∞ –ù–∞—á–∏—Å–ª–∏—Ç—å –±–∞–ª–ª—ã</h3>
                    <button onclick="closeModal('earnPointsModal')" class="close-btn">√ó</button>
                </div>
                
                <div class="modal-body">
                    <!-- QR Scanner Section -->
                    <div class="qr-section">
                        <h4>üì± –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞</h4>
                        <button class="qr-scan-btn" onclick="startQRScanner()">üì± –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥</button>
                        <div id="qrScannerContainer" class="qr-scanner-container" style="display: none;">
                            <video id="qrVideo" autoplay muted></video>
                            <canvas id="qrCanvas" style="display: none;"></canvas>
                            <div class="scanner-overlay">
                                <div class="scanner-frame"></div>
                                <p class="scanner-hint">–†–∞—Å–ø–æ–ª–æ–∂–∏—Ç–µ QR-–∫–æ–¥ –≤ —Ä–∞–º–∫–µ</p>
                            </div>
                            <button class="stop-scan-btn" onclick="stopQRScanner()">‚ùå –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∫–∞–Ω–µ—Ä</button>
                        </div>
                    </div>

                    <!-- Manual Code Input Section -->
                    <div class="manual-code-section">
                        <h4>‚å®Ô∏è –ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –≤—Ä—É—á–Ω—É—é</h4>
                        <div class="code-input-group">
                            <input type="text" id="manualCodeInput" maxlength="8" placeholder="12345678" pattern="[0-9]{8}">
                            <button class="apply-code-btn" onclick="applyManualCode()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                        </div>
                        <small class="code-hint">–í–≤–µ–¥–∏—Ç–µ 8-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞</small>
                    </div>

                    <!-- Customer Info Display -->
                    <div id="customerInfoEarn" class="customer-info" style="display: none;">
                        <h4>üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ</h4>
                        <div class="customer-details">
                            <p><strong>–ò–º—è:</strong> <span id="customerNameEarn">-</span></p>
                            <p><strong>–¢–µ–∫—É—â–∏–µ –±–∞–ª–ª—ã:</strong> <span id="customerPointsEarn">-</span></p>
                            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="customerStatusEarn">-</span></p>
                        </div>
                    </div>
                    
                    <!-- Order Section -->
                    <div class="order-section">
                        <h4>üìã –î–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞</h4>
                        <div class="form-group">
                            <label for="orderAmount">–°—É–º–º–∞ –∑–∞–∫–∞–∑–∞ (‚ÇΩ):</label>
                            <input type="number" id="orderAmount" min="1" step="0.01" placeholder="0.00">
                        </div>
                        <div class="points-preview">
                            <span>–ë–∞–ª–ª–æ–≤ –±—É–¥–µ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–æ:</span>
                            <strong id="pointsToEarn">0</strong>
                        </div>
                        <button onclick="confirmEarnPoints()" class="confirm-btn" disabled id="confirmEarnBtn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –±–∞–ª–ª—ã</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Spend Points Modal -->
        <div id="spendPointsModal" class="modal">
            <div class="modal-content large-modal">
                <div class="modal-header">
                    <h3>üéØ –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å–∫–∏–¥–∫—É</h3>
                    <button onclick="closeModal('spendPointsModal')" class="close-btn">√ó</button>
                </div>
                
                <div class="modal-body">
                    <!-- QR Scanner Section -->
                    <div class="qr-section">
                        <h4>üì± –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞</h4>
                        <button class="qr-scan-btn" onclick="startQRScannerSpend()">üì± –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥</button>
                        <div id="qrScannerContainerSpend" class="qr-scanner-container" style="display: none;">
                            <video id="qrVideoSpend" autoplay muted></video>
                            <canvas id="qrCanvasSpend" style="display: none;"></canvas>
                            <div class="scanner-overlay">
                                <div class="scanner-frame"></div>
                                <p class="scanner-hint">–†–∞—Å–ø–æ–ª–æ–∂–∏—Ç–µ QR-–∫–æ–¥ –≤ —Ä–∞–º–∫–µ</p>
                            </div>
                            <button class="stop-scan-btn" onclick="stopQRScannerSpend()">‚ùå –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∫–∞–Ω–µ—Ä</button>
                        </div>
                    </div>

                    <!-- Manual Code Input Section -->
                    <div class="manual-code-section">
                        <h4>‚å®Ô∏è –ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –≤—Ä—É—á–Ω—É—é</h4>
                        <div class="code-input-group">
                            <input type="text" id="manualCodeInputSpend" maxlength="8" placeholder="12345678" pattern="[0-9]{8}">
                            <button class="apply-code-btn" onclick="applyManualCodeSpend()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                        </div>
                        <small class="code-hint">–í–≤–µ–¥–∏—Ç–µ 8-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞</small>
                    </div>
                    
                    <div class="customer-info" id="customerInfo" style="display: none;">
                        <h4>üë§ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ</h4>
                        <div class="customer-details">
                            <p><strong>–ò–º—è:</strong> <span id="customerName">-</span></p>
                            <p><strong>–î–æ—Å—Ç—É–ø–Ω—ã–µ –±–∞–ª–ª—ã:</strong> <span id="customerPoints">0</span></p>
                            <p><strong>–°—É–º–º–∞ —Å–∫–∏–¥–∫–∏:</strong> <span id="discountValue">‚ÇΩ 0,00</span></p>
                        </div>
                    </div>
                    
                    <div class="order-section">
                        <h4>üìã –î–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞</h4>
                        <div class="form-group">
                            <label for="spendOrderAmount">–°—É–º–º–∞ –∑–∞–∫–∞–∑–∞ (‚ÇΩ):</label>
                            <input type="number" id="spendOrderAmount" min="1" step="0.01" placeholder="0.00">
                        </div>
                        <div class="final-amount">
                            <span>–ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ —Å–æ —Å–∫–∏–¥–∫–æ–π:</span>
                            <strong id="finalAmount">‚ÇΩ 0,00</strong>
                        </div>
                        <button onclick="confirmSpendPoints()" class="confirm-btn" disabled id="confirmSpendBtn">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å–∫–∏–¥–∫—É</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loyalty Settings Modal -->
        <div id="loyaltySettingsModal" class="modal">
            <div class="modal-content large-modal">
                <div class="modal-header">
                    <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏</h3>
                    <button onclick="closeModal('loyaltySettingsModal')" class="close-btn">√ó</button>
                </div>
                
                <div class="modal-body">
                    <div class="loyalty-settings">
                        <div class="loyalty-toggle">
                            <input type="checkbox" id="loyaltyEnabled" checked>
                            <label for="loyaltyEnabled">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏</label>
                        </div>
                        
                        <div class="loyalty-basic-settings">
                            <h4>–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h4>
                            <div class="form-group">
                                <label for="basePointsPerReal">–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –±–∞–ª–ª–æ–≤:</label>
                                <input type="number" id="basePointsPerReal" value="1.0" min="0.1" max="10.0" step="0.1">
                                <span class="input-hint">–±–∞–ª–ª–æ–≤ –∑–∞ 1 —Ä—É–±–ª—å</span>
                            </div>
                            
                            <div class="form-group">
                                <label for="minOrderAmount">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞:</label>
                                <input type="number" id="minOrderAmount" value="10" min="1" max="1000">
                                <span class="input-hint">—Ä—É–±–ª–µ–π –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–ª–æ–≤</span>
                            </div>
                            
                            <div class="form-group">
                                <label for="maxPointsPerOrder">–ú–∞–∫—Å–∏–º—É–º –±–∞–ª–ª–æ–≤ –∑–∞ –∑–∞–∫–∞–∑:</label>
                                <input type="number" id="maxPointsPerOrder" value="100" min="10" max="10000">
                                <span class="input-hint">–∑–∞—â–∏—Ç–∞ –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π</span>
                            </div>
                        </div>
                        
                        <div class="loyalty-advanced-settings">
                            <div class="loyalty-toggle">
                                <input type="checkbox" id="specialDaysEnabled">
                                <label for="specialDaysEnabled">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –¥–Ω–∏</label>
                            </div>
                            
                            <div class="special-days-grid" id="specialDaysGrid">
                                <div class="day-row">
                                    <span class="day-label">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫:</span>
                                    <input type="number" id="mondayMultiplier" value="1.0" min="0.1" max="5.0" step="0.1">
                                    <span class="multiplier-hint">x –±–∞–ª–ª–æ–≤</span>
                                </div>
                                <div class="day-row">
                                    <span class="day-label">–í—Ç–æ—Ä–Ω–∏–∫:</span>
                                    <input type="number" id="tuesdayMultiplier" value="1.0" min="0.1" max="5.0" step="0.1">
                                    <span class="multiplier-hint">x –±–∞–ª–ª–æ–≤</span>
                                </div>
                                <div class="day-row">
                                    <span class="day-label">–°—Ä–µ–¥–∞:</span>
                                    <input type="number" id="wednesdayMultiplier" value="1.0" min="0.1" max="5.0" step="0.1">
                                    <span class="multiplier-hint">x –±–∞–ª–ª–æ–≤</span>
                                </div>
                                <div class="day-row">
                                    <span class="day-label">–ß–µ—Ç–≤–µ—Ä–≥:</span>
                                    <input type="number" id="thursdayMultiplier" value="1.0" min="0.1" max="5.0" step="0.1">
                                    <span class="multiplier-hint">x –±–∞–ª–ª–æ–≤</span>
                                </div>
                                <div class="day-row">
                                    <span class="day-label">–ü—è—Ç–Ω–∏—Ü–∞:</span>
                                    <input type="number" id="fridayMultiplier" value="1.0" min="0.1" max="5.0" step="0.1">
                                    <span class="multiplier-hint">x –±–∞–ª–ª–æ–≤</span>
                                </div>
                                <div class="day-row">
                                    <span class="day-label">–°—É–±–±–æ—Ç–∞:</span>
                                    <input type="number" id="saturdayMultiplier" value="1.0" min="0.1" max="5.0" step="0.1">
                                    <span class="multiplier-hint">x –±–∞–ª–ª–æ–≤</span>
                                </div>
                                <div class="day-row">
                                    <span class="day-label">–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ:</span>
                                    <input type="number" id="sundayMultiplier" value="1.0" min="0.1" max="5.0" step="0.1">
                                    <span class="multiplier-hint">x –±–∞–ª–ª–æ–≤</span>
                                </div>
                            </div>
                            
                            <div class="loyalty-toggle">
                                <input type="checkbox" id="timePeriodsEnabled">
                                <label for="timePeriodsEnabled">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã</label>
                            </div>
                            
                            <div class="time-periods-grid" id="timePeriodsGrid">
                                <div class="time-row">
                                    <span class="time-label">–£—Ç—Ä–æ (9:00-12:00):</span>
                                    <input type="number" id="morningMultiplier" value="1.0" min="0.1" max="5.0" step="0.1">
                                    <span class="multiplier-hint">x –±–∞–ª–ª–æ–≤</span>
                                </div>
                                <div class="time-row">
                                    <span class="time-label">–î–µ–Ω—å (12:00-18:00):</span>
                                    <input type="number" id="afternoonMultiplier" value="1.0" min="0.1" max="5.0" step="0.1">
                                    <span class="multiplier-hint">x –±–∞–ª–ª–æ–≤</span>
                                </div>
                                <div class="time-row">
                                    <span class="time-label">–í–µ—á–µ—Ä (18:00-22:00):</span>
                                    <input type="number" id="eveningMultiplier" value="1.0" min="0.1" max="5.0" step="0.1">
                                    <span class="multiplier-hint">x –±–∞–ª–ª–æ–≤</span>
                                </div>
                            </div>
                            
                            <div class="loyalty-toggle">
                                <input type="checkbox" id="personalConditionsEnabled">
                                <label for="personalConditionsEnabled">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è</label>
                            </div>
                            
                            <div class="personal-conditions-grid" id="personalConditionsGrid">
                                <div class="condition-row">
                                    <span class="condition-label">VIP-–∫–ª–∏–µ–Ω—Ç—ã:</span>
                                    <input type="number" id="vipMultiplier" value="2.0" min="0.1" max="10.0" step="0.1">
                                    <span class="multiplier-hint">x –±–∞–ª–ª–æ–≤</span>
                                </div>
                                <div class="condition-row">
                                    <span class="condition-label">–ò–º–µ–Ω–∏–Ω–Ω–∏–∫–∏:</span>
                                    <input type="number" id="birthdayMultiplier" value="3.0" min="0.1" max="10.0" step="0.1">
                                    <span class="multiplier-hint">x –±–∞–ª–ª–æ–≤</span>
                                </div>
                                <div class="condition-row">
                                    <span class="condition-label">–ü–µ—Ä–≤–∞—è –ø–æ–∫—É–ø–∫–∞:</span>
                                    <input type="number" id="firstOrderMultiplier" value="2.0" min="0.1" max="10.0" step="0.1">
                                    <span class="multiplier-hint">x –±–∞–ª–ª–æ–≤</span>
                                </div>
                            </div>
                        </div>
                        
                        <button onclick="saveLoyaltySettings()" class="save-btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
    <script type="module" src="cafe-tma.js"></script>
</body>
</html>
